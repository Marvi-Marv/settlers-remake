<?xml version="1.1" encoding="UTF-8"?><!DOCTYPE building SYSTEM "../building.dtd">

<building worker="STONECUTTER" workradius="20">
    <ground groundtype="GRASS"/>
    <ground groundtype="EARTH"/>
    <ground groundtype="FLATTENED"/>

    <blocked dx="0" dy="3" block="true" />
    <blocked dx="2" dy="0" block="true" />
    <blocked dx="1" dy="0" block="true" />
    <blocked dx="0" dy="-1" block="true" />
    <blocked dx="-1" dy="-2" block="true" />
    <blocked dx="-2" dy="-2" block="true" />
    <blocked dx="-1" dy="-1" block="true" />
    <blocked dx="-2" dy="-1" block="true" />
    <blocked dx="-2" dy="1" block="true" />
    <blocked dx="-2" dy="0" block="true" />
    <blocked dx="-1" dy="0" block="true" />
    <blocked dx="0" dy="0" block="true" />
    <blocked dx="1" dy="2" block="true" />
    <blocked dx="1" dy="1" block="true" />
    <blocked dx="0" dy="1" block="true" />
    <blocked dx="-1" dy="1" block="true" />
    <blocked dx="0" dy="2" block="true" />
    <blocked dx="-1" dy="2" block="true" />
    <blocked dx="-2" dy="2" block="true" />
    <blocked dx="-1" dy="3" block="true" />
    <blocked dx="0" dy="4" block="true" />
    <blocked dx="-1" dy="-3" block="true" />
    <blocked dx="-2" dy="-4" block="true" />
    <blocked dx="-2" dy="-3" block="true" />
    <blocked dx="2" dy="2" block="true" />
    <blocked dx="1" dy="4" block="true" />
    <blocked dx="1" dy="-1" block="true" />
    <blocked dx="1" dy="3" block="true" />
    <blocked dx="1" dy="5" block="true" />
    <blocked dx="0" dy="-2" block="true" />

    <blocked dx="3" dy="0" block="false" />
    <blocked dx="3" dy="4" block="false" />
    <blocked dx="3" dy="3" block="false" />
    <blocked dx="3" dy="6" block="false" />
    <blocked dx="2" dy="5" block="false" />
    <blocked dx="3" dy="5" block="false" />
    <blocked dx="-3" dy="-6" block="false" />
    <blocked dx="2" dy="1" block="false" />
    <blocked dx="3" dy="1" block="false" />
    <blocked dx="2" dy="3" block="false" />
    <blocked dx="2" dy="4" block="false" />
    <blocked dx="0" dy="5" block="false" />
    <blocked dx="-1" dy="4" block="false" />
    <blocked dx="-2" dy="3" block="false" />
    <blocked dx="-3" dy="2" block="false" />
    <blocked dx="1" dy="6" block="false" />
    <blocked dx="2" dy="6" block="false" />
    <blocked dx="0" dy="6" block="false" />
    <blocked dx="-1" dy="5" block="false" />
    <blocked dx="2" dy="7" block="false" />
    <blocked dx="1" dy="8" block="false" />
    <blocked dx="2" dy="9" block="false" />
    <blocked dx="2" dy="8" block="false" />
    <blocked dx="1" dy="7" block="false" />
    <blocked dx="3" dy="7" block="false" />
    <blocked dx="-2" dy="4" block="false" />
    <blocked dx="3" dy="2" block="false" />
    <blocked dx="4" dy="3" block="false" />
    <blocked dx="2" dy="-1" block="false" />
    <blocked dx="1" dy="-2" block="false" />
    <blocked dx="0" dy="-3" block="false" />
    <blocked dx="-1" dy="-4" block="false" />
    <blocked dx="-2" dy="-5" block="false" />
    <blocked dx="-3" dy="-4" block="false" />
    <blocked dx="-3" dy="-5" block="false" />
    <blocked dx="-3" dy="-3" block="false" />
    <blocked dx="-3" dy="1" block="false" />
    <blocked dx="-3" dy="0" block="false" />
    <blocked dx="-3" dy="-1" block="false" />
    <blocked dx="-3" dy="-2" block="false" />
    <blocked dx="-4" dy="-1" block="false" />
    <blocked dx="-4" dy="0" block="false" />

    <door dx="2" dy="1" />

    <constructionStack dx="4" dy="3" material="PLANK" buildrequired="1" />
    <constructionStack dx="5" dy="3" material="STONE" buildrequired="3" />
    <offerStack dx="4" dy="3" material="STONE" />

    <bricklayer dx="-1" dy="4" direction="NORTH_EAST" />
    <bricklayer dx="2" dy="5" direction="NORTH_EAST" />
    <bricklayer dx="3" dy="1" direction="NORTH_WEST" />
    <bricklayer dx="3" dy="3" direction="NORTH_WEST" />

    <flag dx="0" dy="-2" />

    <buildmark dx="2" dy="1" />
    <buildmark dx="2" dy="0" />
    <buildmark dx="0" dy="4" />
    <buildmark dx="-2" dy="1" />
    <buildmark dx="-2" dy="-3" />
    <buildmark dx="-1" dy="-3" />

    <image file="24" type="GUI" for="GUI" image="0" sequence="42" />
    <image file="23" type="SETTLER" for="FINAL" image="0" sequence="3"/>
    <image file="23" type="SETTLER" for="BUILD" image="1" sequence="3"/>

    <startjob name="gohome"/>

    <!-- go home -->
    <job name="gohome" 			type="GO_TO" 			successjob="hide" 			failjob="gohome_wait" 	dx="2" dy="1"/>
    <!-- go home failed, retry -->
    <job name="gohome_wait" 	type="WAIT" 			successjob="gohome" 		failjob="gohome_wait" 	time="1.0"/>

    <!-- arrive at front door => hide -->
    <job name="hide" 			type="HIDE" 			successjob="reset" 			failjob="gohome_wait"/>
    <job name="reset" 			type="SET_MATERIAL"		successjob="wait_at_home" 	failjob="wait_at_home" 	material="NO_MATERIAL"/>

    <!-- wait some time -->
    <job name="wait_at_home" 	type="WAIT" 			successjob="check" 			failjob="wait_at_home" 	time="3.0"/>

    <job name="check" 			type="NOT_FULL" 		successjob="presearch" 		failjob="hide" 			dx="4" dy="3" />

    <!-- show -->
    <job name="presearch" 		type="PRE_SEARCH" 		successjob="show" 			failjob="wait_at_home" 	search="CUTTABLE_STONE" dx="2" dy="1"/>
    <job name="show" 			type="SHOW" 			successjob="search_stone" 	failjob="hide" 			dx="2" dy="1"/>

    <!-- go search the stones -->
    <job name="search_stone" 	type="FOLLOW_SEARCHED" 	successjob="look_at_stone" 	failjob="gohome"/>

    <!-- hack the stone -->
    <job name="look_at_stone" 	type="LOOK_AT" 			successjob="hit_stone1" 	failjob="gohome" 		direction="SOUTH_WEST"/>
    <job name="hit_stone1" 		type="PLAY_ACTION1" 	successjob="hit_stone2" 	failjob="gohome" 		time="0.75"/>
    <job name="hit_stone2" 		type="PLAY_ACTION1" 	successjob="hit_stone3" 	failjob="gohome" 		time="0.75"/>
    <job name="hit_stone3" 		type="PLAY_ACTION1" 	successjob="hit_stone4" 	failjob="gohome" 		time="0.75"/>
    <job name="hit_stone4" 		type="PLAY_ACTION1" 	successjob="hit_stone5" 	failjob="gohome" 		time="0.75"/>
    <job name="hit_stone5" 		type="PLAY_ACTION1" 	successjob="hit_stone6" 	failjob="gohome" 		time="0.75"/>
    <job name="hit_stone6" 		type="PLAY_ACTION1" 	successjob="execute" 		failjob="gohome" 		time="0.75"/>

    <job name="execute" 		type="EXECUTE" 			successjob="take_stone" 	failjob="gohome" 		search="CUTTABLE_STONE"/>
    <job name="take_stone" 		type="TAKE" 			successjob="go_drop_stone" 	failjob="gohome" 		material="STONE"  takeMaterialFromMap="false"/>

    <!-- drop it at (3|4) -->
    <job name="go_drop_stone"	type="GO_TO" 			successjob="drop_stone" 	failjob="set_mat_none" 	dx="4" dy="3"/>
    <job name="drop_stone" 		type="DROP" 			successjob="gohome" 		failjob="set_mat_none" 	material="STONE"/>

    <job name="set_mat_none" 	type="SET_MATERIAL" 	successjob="gohome" 			failjob="gohome" 		material="NO_MATERIAL"/>

</building>
